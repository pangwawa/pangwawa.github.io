---
title: "Elasticsearch聚合—桶（bucket）和指标（metric）"
tags: ["ElasticSearch", "OLAP","大数据"]
author: "Jack Wu"
date: 2020-03-05T17:07:30+08:00
draft: false
---

聚合的两个核心概念：桶（bucket）和指标（metric）

　桶（bucket）: 满足特定条件的文档的集合

  指标（metric）: 对桶内的文档进行聚合分析的操作
  
桶在概念上类似于SQL的分组（GROUP BY）,而指标则类似于COUNT()、SUM()、MAX()等统计方法。


2、桶和指标的深入理解                                                          

（1）桶　　

　　a、简单来说桶就是满足特定条件的文档的集合。

　　b、当聚合开始被执行，每个文档里面的值通过计算来决定符合哪个桶的条件，如果匹配到，文档将放入相应的桶并接着开始聚合操作。

　　c、桶也可以被嵌套在其他桶里面。

（2）指标

　　a、桶能让我们划分文档到有意义的集合，但是最终我们需要的是对这些桶内的文档进行一些指标的计算。分桶是一种达到目的地的手段：它提供了一种给文档分组的方法来让我们可以计算感兴趣的指标。

　　b、大多数指标是简单的数学运算（如：最小值、平均值、最大值、汇总），这些是通过文档的值来计算的。

（3）桶和指标的组合

　　聚合是由桶和指标组成的。聚合可能只有一个桶，可能只有一个指标，或者可能两个都有。也有可能一些桶嵌套在其他桶里面。